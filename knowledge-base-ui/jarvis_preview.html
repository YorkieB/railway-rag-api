<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JARVIS - Knowledge Base UI Preview</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a0a2e 0%, #2d1b4e 50%, #1a0a2e 100%);
            min-height: 100vh;
            padding: 20px;
            color: #ffffff;
        }
        
        .jarvis-header {
            text-align: center;
            padding: 30px 20px;
            background: rgba(26, 10, 46, 0.8);
            border-radius: 20px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        .jarvis-title {
            font-size: 3em;
            font-weight: 700;
            background: linear-gradient(135deg, #8b5cf6 0%, #e9d5ff 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
            letter-spacing: 2px;
        }
        
        .jarvis-subtitle {
            color: #c4b5fd;
            font-size: 1.1em;
            font-weight: 300;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
        }
        
        .main-layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        /* Chat Container */
        .chat-container {
            background: #ffffff;
            border: 1px solid #e0e0e0;
            border-radius: 15px;
            padding: 25px;
            min-height: 500px;
            overflow-y: auto;
            margin-top: 0;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            flex: 1;
        }
        
        .message-user {
            background: rgba(139, 92, 246, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin: 0 0 20px 0;
            border-left: 4px solid #8b5cf6;
            color: #333333;
        }
        
        .answer-box {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            color: #333333;
        }
        
        .answer-box strong {
            color: #8b5cf6;
            font-size: 1.1em;
        }
        
        /* Chat Input Container */
        .chat-input-container {
            background: #ffffff;
            border: 1px solid #e0e0e0;
            border-radius: 15px;
            padding: 15px 20px;
            margin-top: 0;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .chat-input-title {
            color: #333333;
            font-size: 1.1em;
            font-weight: 600;
            margin-bottom: 15px;
        }
        
        .input-row {
            display: flex;
            gap: 10px;
        }
        
        .chat-input {
            flex: 1;
            padding: 12px 15px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            background: #f9fafb;
        }
        
        .btn-search, .btn-upload {
            padding: 12px 20px;
            background: linear-gradient(135deg, #8b5cf6 0%, #6d28d9 100%);
            border: none;
            border-radius: 8px;
            color: white;
            font-size: 1.2em;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(139, 92, 246, 0.4);
            transition: all 0.3s;
        }
        
        .btn-search:hover, .btn-upload:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(139, 92, 246, 0.6);
        }
        
        /* Artefact Pattern Panel */
        .artefact-wrapper {
            display: flex;
            flex-direction: column;
            height: 100%;
        }
        
        .artefact-panel {
            background: #ffffff;
            border: 1px solid #e0e0e0;
            border-radius: 15px;
            padding: 25px;
            min-height: 500px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            margin-top: 0;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            flex: 1;
        }
        
        .artefact-title-inner {
            color: #333333;
            font-size: 1.3em;
            margin-bottom: 20px;
            font-weight: 600;
        }
        
        .artefact-item {
            background: #1a0a2e;
            border: 1px solid #6d28d9;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            flex: 1;
            display: flex;
            flex-direction: column;
            min-height: 0;
        }
        
        .artefact-header {
            color: #e9d5ff;
            font-weight: 600;
            margin-bottom: 15px;
            font-size: 1.1em;
            flex-shrink: 0;
        }
        
        .artefact-code {
            color: #c4b5fd;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            line-height: 1.6;
            white-space: pre-wrap;
            flex: 1;
            overflow-y: auto;
            min-height: 0;
        }
        
        /* Settings/Features Box */
        .settings-box {
            background: #ffffff;
            border: 1px solid #e0e0e0;
            border-radius: 15px;
            padding: 15px 20px;
            margin-top: 0;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            height: 120px;
            min-height: 120px;
            max-height: 120px;
        }
        
        .features-row {
            display: flex;
            flex-direction: row;
            gap: 20px;
            margin-top: 20px;
        }
        
        .features-row .settings-box {
            flex: 1;
            margin-bottom: 0;
        }
        
        .settings-box h3 {
            color: #333333;
            margin-bottom: 15px;
            flex-shrink: 0;
        }
        
        .icon-btn {
            background: linear-gradient(135deg, #8b5cf6 0%, #6d28d9 100%);
            border: none;
            border-radius: 8px;
            color: white;
            font-size: 1.3em;
            height: 38px;
            width: 100%;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(139, 92, 246, 0.4);
            transition: all 0.3s;
        }
        
        .icon-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(139, 92, 246, 0.6);
        }
        
        .sources-section {
            margin-top: 15px;
        }
        
        /* Animated notepad icon - writing animation (icon only, faster) */
        @keyframes notepadWrite {
            0%, 100% { transform: rotate(0deg) scale(1); }
            10% { transform: rotate(-2deg) scale(1.05); }
            20% { transform: rotate(2deg) scale(1.05); }
            30% { transform: rotate(-1deg) scale(1); }
            40% { transform: rotate(1deg) scale(1.05); }
            50% { transform: rotate(0deg) scale(1); }
            60% { transform: rotate(-1deg) scale(1.03); }
            70% { transform: rotate(1deg) scale(1.03); }
            80% { transform: rotate(0deg) scale(1); }
        }
        
        .notepad-icon {
            display: inline-block;
            animation: notepadWrite 0.8s ease-in-out infinite;
        }
        
        /* Animated video camera icon - recording pulse (icon only, faster) */
        @keyframes cameraRecord {
            0%, 100% { 
                transform: scale(1);
                filter: brightness(1);
            }
            25% { 
                transform: scale(1.1);
                filter: brightness(1.3);
            }
            50% { 
                transform: scale(1.15);
                filter: brightness(1.5);
            }
            75% { 
                transform: scale(1.1);
                filter: brightness(1.3);
            }
        }
        
        @keyframes cameraPulse {
            0%, 100% { 
                opacity: 0.3;
                transform: scale(1);
            }
            50% { 
                opacity: 0.8;
                transform: scale(1.2);
            }
        }
        
        .camera-icon {
            display: inline-block;
            animation: cameraRecord 1s ease-in-out infinite;
            position: relative;
        }
        
        .camera-icon::after {
            content: "üî¥";
            position: absolute;
            top: -2px;
            right: -2px;
            font-size: 0.5em;
            animation: cameraPulse 1s ease-in-out infinite;
            pointer-events: none;
        }
        
        /* Animated sparkles for voice chat button - multiple sparkles */
        @keyframes sparkle {
            0%, 100% { opacity: 0; transform: scale(0) rotate(0deg) translateY(0); }
            25% { opacity: 0.8; transform: scale(1.2) rotate(90deg) translateY(-5px); }
            50% { opacity: 1; transform: scale(1) rotate(180deg) translateY(-10px); }
            75% { opacity: 0.8; transform: scale(1.2) rotate(270deg) translateY(-5px); }
        }
        
        @keyframes sparkle2 {
            0%, 100% { opacity: 0; transform: scale(0) rotate(0deg) translateY(0); }
            30% { opacity: 1; transform: scale(1.3) rotate(120deg) translateY(-8px); }
            60% { opacity: 0.7; transform: scale(0.9) rotate(240deg) translateY(-12px); }
        }
        
        @keyframes sparkle3 {
            0%, 100% { opacity: 0; transform: scale(0) rotate(0deg) translateY(0); }
            20% { opacity: 0.9; transform: scale(1.1) rotate(60deg) translateY(-6px); }
            50% { opacity: 1; transform: scale(1.4) rotate(180deg) translateY(-10px); }
            80% { opacity: 0.6; transform: scale(0.8) rotate(300deg) translateY(-4px); }
        }
        
        .voice-chat-wrapper {
            position: relative;
            overflow: visible;
        }
        
        .voice-chat-wrapper::before,
        .voice-chat-wrapper::after {
            content: "‚ú®";
            position: absolute;
            font-size: 1.3em;
            pointer-events: none;
            z-index: 10;
        }
        
        .voice-chat-wrapper::before {
            top: -12px;
            left: 10px;
            animation: sparkle 2s infinite;
            animation-delay: 0s;
        }
        
        .voice-chat-wrapper::after {
            top: -12px;
            right: 10px;
            animation: sparkle 2s infinite;
            animation-delay: 1s;
        }
        
        /* Additional sparkles using pseudo-elements on the button itself */
        .voice-chat-sparkles {
            position: relative;
        }
        
        .voice-chat-sparkles::before,
        .voice-chat-sparkles::after {
            content: "‚ú®";
            position: absolute;
            font-size: 1.1em;
            pointer-events: none;
            z-index: 11;
        }
        
        .voice-chat-sparkles::before {
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            animation: sparkle2 2.5s infinite;
            animation-delay: 0.5s;
        }
        
        .voice-chat-sparkles::after {
            bottom: -10px;
            left: 30%;
            animation: sparkle3 2.2s infinite;
            animation-delay: 1.2s;
        }
        
        /* Voice conversation panel */
        .voice-conversation-panel {
            background: #ffffff;
            border: 2px solid #8b5cf6;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 8px 24px rgba(139, 92, 246, 0.4);
            max-width: 1600px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .voice-status {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: rgba(139, 92, 246, 0.1);
            border-radius: 8px;
            margin-bottom: 15px;
        }
        
        .pulse-dot {
            width: 12px;
            height: 12px;
            background: #8b5cf6;
            border-radius: 50%;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(1.2); }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideUp {
            from {
                transform: translateY(50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        .voice-message {
            background: rgba(139, 92, 246, 0.1);
            padding: 10px;
            border-radius: 8px;
            margin: 5px 0;
            border-left: 3px solid #8b5cf6;
            color: #333333;
        }
        
        .voice-controls {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin: 15px 0;
        }
        
        .voice-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            margin: 10px 0;
            background: #f9fafb;
        }
    </style>
</head>
<body>
    <!-- JARVIS Header with image upload areas -->
    <div style="display: grid; grid-template-columns: 1fr 2fr 1fr; gap: 20px; margin-bottom: 30px;">
        <!-- Left Image Upload Area -->
        <div class="header-image-upload">
            <div style="background: rgba(139, 92, 246, 0.1); border: 2px dashed #8b5cf6; border-radius: 10px; padding: 15px; text-align: center; color: #c4b5fd; min-height: 100px; display: flex; align-items: center; justify-content: center;">
                <div>
                    <div style="font-size: 2em; margin-bottom: 5px;">üì∑</div>
                    <div style="font-size: 0.9em;">Upload Image 1</div>
                </div>
            </div>
        </div>
        
        <!-- JARVIS Header -->
        <div class="jarvis-header">
            <div class="jarvis-title">
                <span style="font-size: 1.2em;">ü§ñ</span>
                JARVIS
            </div>
            <div class="jarvis-subtitle">Powered by Google Cloud RAG System</div>
        </div>
        
        <!-- Right Image Upload Area -->
        <div class="header-image-upload">
            <div style="background: rgba(139, 92, 246, 0.1); border: 2px dashed #8b5cf6; border-radius: 10px; padding: 15px; text-align: center; color: #c4b5fd; min-height: 100px; display: flex; align-items: center; justify-content: center;">
                <div>
                    <div style="font-size: 2em; margin-bottom: 5px;">üì∑</div>
                    <div style="font-size: 0.9em;">Upload Image 2</div>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="main-layout">
            <!-- Left Column -->
            <div style="display: flex; flex-direction: column; flex: 1;">
                <!-- Chat Container - TOP -->
                <div class="chat-container">
                    <!-- User Message -->
                    <div style="color: #333333; font-size: 1.3em; font-weight: 600; margin-bottom: 5px; margin-top: 15px;">
                        User Query
                    </div>
                    <div class="message-user">
                        <strong>You:</strong>
                        <p>What does the test document contain?</p>
                    </div>

                    <!-- JARVIS Answer -->
                    <div class="answer-box">
                        <strong>JARVIS:</strong>
                        <div style="margin-top: 10px;">
                            The test document contains sample content that demonstrates the upload functionality. It includes information about how the system processes documents: extracting text, chunking it into smaller pieces, generating embeddings for each chunk, storing them in BigQuery, and retrieving them when answering questions. This is useful for testing the upload endpoint and verifying that documents are properly processed and stored.
                        </div>
                    </div>

                    <!-- Sources Compact Dropdown -->
                    <div class="sources-section" style="margin-top: 15px;">
                        <label style="color: #333333; font-size: 0.9em; font-weight: 600; display: block; margin-bottom: 5px;">
                            üìö Sources (2 found)
                        </label>
                        <select style="width: 100%; background: #f5f5f5; border: 1px solid #e0e0e0; border-radius: 8px; padding: 8px 12px; color: #333333; font-size: 0.9em;">
                            <option>test_document.txt (Score: 0.856)</option>
                            <option>Research Paper.pdf (Score: 0.782)</option>
                        </select>
                    </div>
                </div>
                
                <!-- Chat Input - BOTTOM -->
                <div class="chat-input-container">
                    <div class="chat-input-title">üí¨ Chat Input</div>
                    <div class="input-row">
                        <input type="text" class="chat-input" placeholder="Ask JARVIS anything..." id="chatInput">
                        <button class="btn-search" onclick="handleSearch()">üîç</button>
                        <button class="btn-upload" onclick="handleUpload()">‚ûï</button>
                    </div>
                </div>
            </div>
            
            <!-- Right Column -->
            <div style="display: flex; flex-direction: column; flex: 1;">
                <!-- Artefact Pattern Panel - TOP -->
                <div class="artefact-wrapper">
                    <div class="artefact-panel">
                        <div class="artefact-title-inner"># JARVIS Artefact Pattern</div>
                        <div class="artefact-item">
                            <div class="artefact-header">JARVIS Query Processing Artefact</div>
                            <div class="artefact-code">wf.invst
@JARVIS #wf2.R1_nltk.steq_orientate 'tan'
def init_context():
    init_wf = jarvis_load 'onton exforces'
    load_data.config
    wf.find_terms
    wf.vector
    JARVIS.adffet
    lantontak
    kenmany</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Row for the three small feature containers - same height and width -->
        <div class="features-row">
            <!-- Additional Features container -->
            <div class="settings-box">
                <h3>‚öôÔ∏è Additional Features</h3>
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px;">
                    <button class="icon-btn" title="NotePad"><span class="notepad-icon">üìù</span></button>
                    <button class="icon-btn" title="Video Assistant"><span class="camera-icon">üìπ</span></button>
                    <div class="voice-chat-wrapper">
                        <div class="voice-chat-sparkles">
                            <button class="icon-btn" title="Real-time voice conversation with JARVIS" onclick="toggleVoicePopup()" style="position: relative;">‚ú®</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Settings & Features container -->
            <div class="settings-box">
                <h3>‚öôÔ∏è Settings & Features</h3>
                <div style="display: grid; grid-template-columns: repeat(6, 1fr); gap: 8px;">
                    <button class="icon-btn" title="Settings & API Keys" onclick="toggleSettingsPanel()">‚öôÔ∏è</button>
                    <button class="icon-btn" title="Analytics">üìä</button>
                    <button class="icon-btn" title="Export">üì§</button>
                    <button class="icon-btn" title="Import">üì•</button>
                    <button class="icon-btn" title="Sync">üîÑ</button>
                    <button class="icon-btn" title="Security">üîê</button>
                </div>
            </div>
            
            <!-- Additional Settings container -->
            <div class="settings-box">
                <h3>‚öôÔ∏è Additional Settings</h3>
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px;">
                    <button class="icon-btn" title="API Keys">üåê</button>
                    <button class="icon-btn" title="Reports">üìä</button>
                    <button class="icon-btn" title="Performance">‚ö°</button>
                </div>
            </div>
        </div>
        
        <!-- Voice Conversation Panel (shown when voice chat is active) -->
        <div id="voiceChatPanel" class="voice-conversation-panel" style="display: none;">
            <h3 style="color: #333333; margin-bottom: 15px;">üé§ Real-Time Voice Conversation with JARVIS</h3>
            
            <!-- Status indicator -->
            <div class="voice-status">
                <div class="pulse-dot"></div>
                <span style="color: #10b981; font-weight: 600;">Voice Chat Active - Ready for conversation</span>
            </div>
            
            <!-- Eleven Labs API Key input -->
            <div style="margin-bottom: 15px;">
                <label style="color: #333333; font-weight: 600; display: block; margin-bottom: 5px;">üîë Eleven Labs API Key</label>
                <input type="password" class="voice-input" placeholder="Enter your Eleven Labs API key" style="color: #333333;">
            </div>
            
            <!-- Voice Mode Selection -->
            <div style="margin-bottom: 20px; padding: 15px; background: rgba(139, 92, 246, 0.1); border-radius: 10px;">
                <label style="color: #333333; font-weight: 600; display: block; margin-bottom: 10px;">üéôÔ∏è Voice Mode</label>
                <div style="display: flex; gap: 15px;">
                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                        <input type="radio" name="voice-mode" value="gemini-live" checked>
                        <span style="color: #333333;">Gemini Live (Real-time)</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                        <input type="radio" name="voice-mode" value="elevenlabs">
                        <span style="color: #333333;">Eleven Labs (TTS)</span>
                    </label>
                </div>
            </div>
            
            <!-- Gemini Live Interface -->
            <div id="gemini-live-section" style="margin-bottom: 20px;">
                <h4 style="color: #333333; margin: 20px 0 10px 0;">üé• Gemini Live Real-Time Vision & Voice</h4>
                <p style="color: #666; font-size: 0.9em; margin-bottom: 15px;">üí° <strong>Real-time video guidance:</strong> The AI can see you and describe everything around you while you talk in real-time</p>
                
                <!-- Video Vision Toggle -->
                <label style="display: flex; align-items: center; gap: 8px; margin-bottom: 15px; cursor: pointer;">
                    <input type="checkbox" id="enable-video" checked>
                    <span style="color: #333333; font-weight: 600;">üìπ Enable Video Vision (AI can see you)</span>
                </label>
                
                <!-- Connect/Disconnect Buttons -->
                <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                    <button class="btn-search" id="connect-gemini-btn" style="flex: 1; background: linear-gradient(135deg, #10b981 0%, #059669 100%);">üîå Connect Gemini Live</button>
                    <button class="btn-search" id="disconnect-gemini-btn" style="flex: 1; background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); display: none;">üîå Disconnect</button>
                </div>
                
                <!-- Gemini Live Multimodal Interface -->
                <div id="gemini-live-container" style="padding: 20px; background: rgba(139, 92, 246, 0.05); border-radius: 10px; margin: 10px 0; display: none;">
                    <!-- Video Preview -->
                    <div id="video-container" style="margin-bottom: 15px; display: none;">
                        <video id="camera-feed" autoplay playsinline style="width: 100%; max-width: 640px; border-radius: 10px; background: #000; border: 2px solid #8b5cf6;"></video>
                        <p style="color: #8b5cf6; font-weight: 600; margin-top: 10px;">üìπ Camera Feed: <span id="camera-status">Not Started</span></p>
                    </div>
                    
                    <!-- Status Indicators -->
                    <div id="status-container" style="margin-bottom: 15px;">
                        <p style="color: #8b5cf6; font-weight: 600;">üé§ Microphone: <span id="mic-status">Not Started</span></p>
                        <p style="color: #8b5cf6; font-weight: 600; margin-top: 5px;">ü§ñ AI Vision: <span id="vision-status">Inactive</span></p>
                    </div>
                    
                    <!-- Control Buttons -->
                    <div style="display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: wrap;">
                        <button id="start-multimodal-btn" style="padding: 12px 24px; background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 1em;">üé• Start Vision & Voice</button>
                        <button id="stop-multimodal-btn" style="padding: 12px 24px; background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); color: white; border: none; border-radius: 8px; cursor: pointer; display: none; font-weight: 600; font-size: 1em;">‚è∏Ô∏è Stop</button>
                    </div>
                    
                    <!-- AI Vision Descriptions -->
                    <div id="vision-descriptions" style="margin-top: 15px; padding: 15px; background: rgba(139, 92, 246, 0.1); border-radius: 8px; max-height: 250px; overflow-y: auto; display: none;">
                        <h4 style="color: #8b5cf6; margin-top: 0; margin-bottom: 10px;">üëÅÔ∏è What I See:</h4>
                        <div id="vision-text" style="color: #333; line-height: 1.6;">
                            <p style="padding: 8px; background: rgba(255, 255, 255, 0.7); border-radius: 5px; margin: 5px 0;">üëÅÔ∏è I can see a person sitting at a desk with a computer monitor. There are books on the shelf behind them and natural lighting coming from a window.</p>
                            <p style="padding: 8px; background: rgba(255, 255, 255, 0.7); border-radius: 5px; margin: 5px 0;">üëÅÔ∏è The room appears to be a home office setup with modern furniture and good organization.</p>
                        </div>
                    </div>
                    
                    <!-- Connection Status -->
                    <div id="connection-status" style="margin-top: 10px; padding: 10px; background: rgba(16, 185, 129, 0.1); border-radius: 5px; display: none;">
                        <p style="color: #10b981; margin: 0; font-weight: 600;">‚úÖ Connected to Gemini Live - Real-time vision & voice active</p>
                    </div>
                </div>
            </div>
            
            <!-- Eleven Labs Interface (Hidden by default) -->
            <div id="elevenlabs-section" style="margin-bottom: 20px; display: none;">
                <h4 style="color: #333333; margin: 20px 0 10px 0;">üéôÔ∏è Eleven Labs Voice Settings</h4>
                
                <!-- Voice settings -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                    <div>
                        <label style="color: #333333; font-weight: 600; display: block; margin-bottom: 5px;">üéôÔ∏è Voice Model</label>
                        <select class="voice-input" style="color: #333333;">
                            <option>21m00Tcm4TlvDq8ikWAM</option>
                            <option>pNInz6obpgDQGcFmaJgB</option>
                            <option>EXAVITQu4vr4xnSDxMaL</option>
                        </select>
                    </div>
                    <div>
                        <label style="color: #333333; font-weight: 600; display: block; margin-bottom: 5px;">Stability: 0.5</label>
                        <input type="range" min="0" max="1" step="0.1" value="0.5" style="width: 100%;">
                        <label style="color: #333333; font-weight: 600; display: block; margin-top: 5px;">Similarity Boost: 0.75</label>
                        <input type="range" min="0" max="1" step="0.1" value="0.75" style="width: 100%;">
                    </div>
                </div>
                
                <!-- Conversation interface -->
                <h4 style="color: #333333; margin: 20px 0 10px 0;">üí¨ Conversation</h4>
                
                <!-- Sample conversation messages -->
                <div class="voice-message">
                    <strong>üé§ User:</strong> What is the purpose of this system?
                </div>
                <div class="voice-message" style="border-left-color: #6d28d9;">
                    <strong>ü§ñ Assistant:</strong> This system is a RAG (Retrieval-Augmented Generation) knowledge base that allows you to upload documents, ask questions, and get intelligent responses powered by Google Cloud and AI.
                </div>
                
                <!-- Voice input controls -->
                <div class="voice-controls">
                    <button class="btn-search" style="font-size: 0.9em; padding: 10px;">üé§ Start Recording</button>
                    <button class="btn-search" style="font-size: 0.9em; padding: 10px;">‚è∏Ô∏è Stop Recording</button>
                    <button class="btn-search" style="font-size: 0.9em; padding: 10px;">üîá Play Response</button>
                </div>
                
                <!-- Text input fallback -->
                <input type="text" class="voice-input" placeholder="üí¨ Or type your message for JARVIS..." style="color: #333333;">
                <button class="btn-search" style="width: 100%; margin-top: 10px;">üì§ Send Message</button>
            </div>
            
            <button class="btn-search" style="width: 100%; margin-top: 10px; background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);">‚ùå Close Voice Chat</button>
        </div>
    </div>

    <script>
        function toggleVoicePopup() {
            const modal = document.getElementById('voicePopupModal');
            if (modal.style.display === 'none' || !modal.style.display) {
                modal.style.display = 'flex';
            } else {
                modal.style.display = 'none';
            }
        }
        
        function closeVoicePopup() {
            document.getElementById('voicePopupModal').style.display = 'none';
        }
        
        function toggleVoiceChat() {
            const panel = document.getElementById('voiceChatPanel');
            if (panel.style.display === 'none') {
                panel.style.display = 'block';
            } else {
                panel.style.display = 'none';
            }
        }
        
        function handleSearch() {
            const input = document.getElementById('chatInput');
            if (input.value.trim()) {
                alert('Search functionality - In live version, this would query the RAG API');
                // In real implementation, this would make an API call
            }
        }

        function handleUpload() {
            alert('Upload functionality - In live version, this would open file upload dialog');
            // In real implementation, this would open file picker
        }

        // Allow Enter key to submit
        document.getElementById('chatInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                handleSearch();
            }
        });
        
        // Voice mode selection
        document.querySelectorAll('input[name="voice-mode"]').forEach(radio => {
            radio.addEventListener('change', function() {
                const geminiSection = document.getElementById('gemini-live-section');
                const elevenlabsSection = document.getElementById('elevenlabs-section');
                if (this.value === 'gemini-live') {
                    geminiSection.style.display = 'block';
                    elevenlabsSection.style.display = 'none';
                } else {
                    geminiSection.style.display = 'none';
                    elevenlabsSection.style.display = 'block';
                }
            });
        });
        
        // Connect Gemini Live
        document.getElementById('connect-gemini-btn')?.addEventListener('click', function() {
            const container = document.getElementById('gemini-live-container');
            const connectBtn = document.getElementById('connect-gemini-btn');
            const disconnectBtn = document.getElementById('disconnect-gemini-btn');
            container.style.display = 'block';
            connectBtn.style.display = 'none';
            disconnectBtn.style.display = 'inline-block';
        });
        
        // Disconnect Gemini Live
        document.getElementById('disconnect-gemini-btn')?.addEventListener('click', function() {
            const container = document.getElementById('gemini-live-container');
            const connectBtn = document.getElementById('connect-gemini-btn');
            const disconnectBtn = document.getElementById('disconnect-gemini-btn');
            container.style.display = 'none';
            connectBtn.style.display = 'inline-block';
            disconnectBtn.style.display = 'none';
        });
        
        // Start Vision & Voice (Preview simulation)
        document.getElementById('start-multimodal-btn')?.addEventListener('click', function() {
            const videoContainer = document.getElementById('video-container');
            const visionDescriptions = document.getElementById('vision-descriptions');
            const connectionStatus = document.getElementById('connection-status');
            const startBtn = document.getElementById('start-multimodal-btn');
            const stopBtn = document.getElementById('stop-multimodal-btn');
            const enableVideo = document.getElementById('enable-video').checked;
            
            if (enableVideo) {
                videoContainer.style.display = 'block';
                document.getElementById('camera-status').textContent = 'Active (Preview)';
                // Simulate video feed
                const video = document.getElementById('camera-feed');
                video.style.background = 'linear-gradient(135deg, #1a0a2e 0%, #2d1b4e 100%)';
                video.style.minHeight = '360px';
                video.style.display = 'flex';
                video.style.alignItems = 'center';
                video.style.justifyContent = 'center';
                video.innerHTML = '<div style="text-align: center; color: #8b5cf6;"><div style="font-size: 3em; margin-bottom: 10px;">üìπ</div><div style="font-size: 1.2em; font-weight: 600;">Camera Feed Preview</div><small style="font-size: 0.8em; opacity: 0.7; display: block; margin-top: 10px;">In live app, this shows your camera feed<br>AI analyzes frames at 1 FPS</small></div>';
            }
            
            document.getElementById('mic-status').textContent = 'Active';
            document.getElementById('vision-status').textContent = enableVideo ? 'Analyzing...' : 'Audio Only';
            visionDescriptions.style.display = 'block';
            connectionStatus.style.display = 'block';
            startBtn.style.display = 'none';
            stopBtn.style.display = 'inline-block';
        });
        
        // Stop Vision & Voice
        document.getElementById('stop-multimodal-btn')?.addEventListener('click', function() {
            const videoContainer = document.getElementById('video-container');
            const visionDescriptions = document.getElementById('vision-descriptions');
            const connectionStatus = document.getElementById('connection-status');
            const startBtn = document.getElementById('start-multimodal-btn');
            const stopBtn = document.getElementById('stop-multimodal-btn');
            
            videoContainer.style.display = 'none';
            document.getElementById('mic-status').textContent = 'Stopped';
            document.getElementById('camera-status').textContent = 'Stopped';
            document.getElementById('vision-status').textContent = 'Inactive';
            connectionStatus.style.display = 'none';
            startBtn.style.display = 'inline-block';
            stopBtn.style.display = 'none';
        });
        
        // Settings Panel Toggle
        function toggleSettingsPanel() {
            const panel = document.getElementById('settingsPanel');
            if (panel.style.display === 'none' || !panel.style.display) {
                panel.style.display = 'block';
            } else {
                panel.style.display = 'none';
            }
        }
        
        // Add Custom API Key
        function addCustomKey() {
            const keyName = document.getElementById('new-key-name').value.trim();
            if (keyName) {
                const customKeysContainer = document.getElementById('custom-keys-container');
                const keyDiv = document.createElement('div');
                keyDiv.style.marginBottom = '10px';
                keyDiv.innerHTML = `
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <input type="password" placeholder="üîë ${keyName}" style="flex: 1; padding: 10px; border: 1px solid #e0e0e0; border-radius: 8px; color: #333;">
                        <button onclick="this.parentElement.parentElement.remove()" style="padding: 10px 15px; background: #ef4444; color: white; border: none; border-radius: 8px; cursor: pointer;">üóëÔ∏è</button>
                    </div>
                `;
                customKeysContainer.appendChild(keyDiv);
                document.getElementById('new-key-name').value = '';
            }
        }
    </script>
    
    <!-- Settings Panel - API Keys & Credentials -->
    <div id="settingsPanel" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.7); z-index: 1000; overflow-y: auto; padding: 20px;">
        <div style="max-width: 800px; margin: 50px auto; background: white; border-radius: 15px; padding: 30px; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                <h2 style="color: #333; margin: 0;">‚öôÔ∏è Settings & API Keys</h2>
                <button onclick="toggleSettingsPanel()" style="background: #ef4444; color: white; border: none; border-radius: 8px; padding: 10px 20px; cursor: pointer; font-weight: 600;">‚ùå Close</button>
            </div>
            
            <div style="background: rgba(139, 92, 246, 0.1); padding: 15px; border-radius: 8px; margin-bottom: 25px; border-left: 4px solid #8b5cf6;">
                <p style="color: #333; margin: 0; font-size: 0.9em;">üí° Enter your API keys below. All keys are stored securely in session state and masked for privacy.</p>
            </div>
            
            <h3 style="color: #333; margin: 25px 0 15px 0;">üåê Core API Keys</h3>
            
            <div style="margin-bottom: 20px;">
                <label style="color: #333; font-weight: 600; display: block; margin-bottom: 8px;">üîó RAG API URL</label>
                <input type="text" placeholder="https://rag-api-883324649002.us-central1.run.app" style="width: 100%; padding: 12px; border: 1px solid #e0e0e0; border-radius: 8px; color: #333; font-size: 0.95em;">
            </div>
            
            <div style="margin-bottom: 20px;">
                <label style="color: #333; font-weight: 600; display: block; margin-bottom: 8px;">ü§ñ Gemini API Key</label>
                <input type="password" placeholder="Enter your Gemini API key" style="width: 100%; padding: 12px; border: 1px solid #e0e0e0; border-radius: 8px; color: #333; font-size: 0.95em;">
            </div>
            
            <div style="margin-bottom: 20px;">
                <label style="color: #333; font-weight: 600; display: block; margin-bottom: 8px;">üéôÔ∏è Eleven Labs API Key</label>
                <input type="password" placeholder="Enter your Eleven Labs API key" style="width: 100%; padding: 12px; border: 1px solid #e0e0e0; border-radius: 8px; color: #333; font-size: 0.95em;">
            </div>
            
            <div style="margin-bottom: 25px;">
                <label style="color: #333; font-weight: 600; display: block; margin-bottom: 8px;">üß† OpenAI API Key (Optional)</label>
                <input type="password" placeholder="Enter your OpenAI API key (optional)" style="width: 100%; padding: 12px; border: 1px solid #e0e0e0; border-radius: 8px; color: #333; font-size: 0.95em;">
            </div>
            
            <hr style="border: none; border-top: 1px solid #e0e0e0; margin: 25px 0;">
            
            <h3 style="color: #333; margin: 25px 0 15px 0;">üîë Custom API Keys</h3>
            <p style="color: #666; font-size: 0.9em; margin-bottom: 15px;">Add additional API keys for custom integrations</p>
            
            <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                <input type="text" id="new-key-name" placeholder="e.g., Anthropic, Cohere, etc." style="flex: 1; padding: 12px; border: 1px solid #e0e0e0; border-radius: 8px; color: #333;">
                <button onclick="addCustomKey()" style="padding: 12px 24px; background: linear-gradient(135deg, #8b5cf6 0%, #6d28d9 100%); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">‚ûï Add</button>
            </div>
            
            <div id="custom-keys-container"></div>
            
            <hr style="border: none; border-top: 1px solid #e0e0e0; margin: 25px 0;">
            
            <h3 style="color: #333; margin: 25px 0 15px 0;">‚úÖ API Key Status</h3>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 25px;">
                <div style="padding: 12px; background: rgba(16, 185, 129, 0.1); border-radius: 8px; border-left: 4px solid #10b981;">
                    <p style="color: #333; margin: 0; font-weight: 600;">‚úÖ Gemini API Key: Configured</p>
                </div>
                <div style="padding: 12px; background: rgba(16, 185, 129, 0.1); border-radius: 8px; border-left: 4px solid #10b981;">
                    <p style="color: #333; margin: 0; font-weight: 600;">‚úÖ RAG API URL: Configured</p>
                </div>
                <div style="padding: 12px; background: rgba(16, 185, 129, 0.1); border-radius: 8px; border-left: 4px solid #10b981;">
                    <p style="color: #333; margin: 0; font-weight: 600;">‚úÖ Eleven Labs API Key: Configured</p>
                </div>
                <div style="padding: 12px; background: rgba(156, 163, 175, 0.1); border-radius: 8px; border-left: 4px solid #9ca3af;">
                    <p style="color: #333; margin: 0; font-weight: 600;">‚ÑπÔ∏è OpenAI API Key: Not set (optional)</p>
                </div>
            </div>
            
            <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                <button style="flex: 1; padding: 12px 24px; background: linear-gradient(135deg, #8b5cf6 0%, #6d28d9 100%); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">üíæ Save All Settings</button>
                <button style="flex: 1; padding: 12px 24px; background: #f3f4f6; color: #333; border: 1px solid #e0e0e0; border-radius: 8px; cursor: pointer; font-weight: 600;">üîÑ Reset to Defaults</button>
                <button onclick="toggleSettingsPanel()" style="flex: 1; padding: 12px 24px; background: #ef4444; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">‚ùå Close Settings</button>
            </div>
            
            <div style="background: rgba(139, 92, 246, 0.1); padding: 15px; border-radius: 8px; border-left: 4px solid #8b5cf6; margin-top: 20px;">
                <p style="color: #333; margin: 0; font-size: 0.9em;">
                    <strong>üîí Security Note:</strong> API keys are stored in session state (temporary, cleared on refresh). 
                    For production, consider using environment variables or a secure key management service.
                </p>
            </div>
        </div>
    </div>
    
    <!-- Voice Conversation Popup Modal -->
    <div id="voicePopupModal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.75); z-index: 9999; align-items: center; justify-content: center; animation: fadeIn 0.3s ease-in-out;">
        <div style="background: white; border-radius: 20px; padding: 30px; max-width: 900px; width: 90%; max-height: 90vh; overflow-y: auto; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5); position: relative; animation: slideUp 0.3s ease-out;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; padding-bottom: 15px; border-bottom: 2px solid #e0e0e0;">
                <h2 style="color: #333; font-size: 1.8em; font-weight: 700; margin: 0;">üé§ Real-Time Voice Conversation with JARVIS</h2>
                <button onclick="closeVoicePopup()" style="background: #ef4444; color: white; border: none; border-radius: 8px; padding: 10px 20px; font-weight: 600; cursor: pointer; font-size: 1em; transition: all 0.3s;">‚ùå Close</button>
            </div>
            
            <!-- Voice Conversation Panel Content -->
            <div class="voice-conversation-panel">
                <!-- Voice Mode Selection -->
                <div style="margin-bottom: 20px; padding: 15px; background: rgba(139, 92, 246, 0.1); border-radius: 10px;">
                    <label style="color: #333; font-weight: 600; display: block; margin-bottom: 10px;">üéôÔ∏è Voice Mode</label>
                    <div style="display: flex; gap: 15px;">
                        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                            <input type="radio" name="voice-mode-popup" value="gemini-live" checked>
                            <span style="color: #333;">Gemini Live (Real-time)</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                            <input type="radio" name="voice-mode-popup" value="elevenlabs">
                            <span style="color: #333;">Eleven Labs (TTS)</span>
                        </label>
                    </div>
                </div>
                
                <!-- Status Indicator -->
                <div class="voice-status">
                    <div class="pulse-dot"></div>
                    <span style="color: #10b981; font-weight: 600;">Voice Chat Active - Ready for conversation</span>
                </div>
                
                <!-- Gemini Live Section -->
                <div id="gemini-live-section-popup" style="margin-bottom: 20px;">
                    <h4 style="color: #333; margin: 20px 0 10px 0;">üé• Gemini Live Real-Time Vision & Voice</h4>
                    <p style="color: #666; font-size: 0.9em; margin-bottom: 15px;">üí° <strong>Real-time video guidance:</strong> The AI can see you and describe everything around you while you talk in real-time</p>
                    
                    <label style="display: flex; align-items: center; gap: 8px; margin-bottom: 15px; cursor: pointer;">
                        <input type="checkbox" id="enable-video-popup" checked>
                        <span style="color: #333; font-weight: 600;">üìπ Enable Video Vision (AI can see you)</span>
                    </label>
                    
                    <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                        <button class="btn-search" style="flex: 1; background: linear-gradient(135deg, #10b981 0%, #059669 100%);">üîå Connect Gemini Live</button>
                    </div>
                </div>
                
                <!-- Conversation Interface -->
                <h4 style="color: #333; margin: 20px 0 10px 0;">üí¨ Conversation</h4>
                
                <div class="voice-message">
                    <strong>üé§ User:</strong> What is the purpose of this system?
                </div>
                <div class="voice-message" style="border-left-color: #6d28d9;">
                    <strong>ü§ñ Assistant:</strong> This system is a RAG (Retrieval-Augmented Generation) knowledge base that allows you to upload documents, ask questions, and get intelligent responses powered by Google Cloud and AI.
                </div>
                
                <!-- Voice Input Controls -->
                <div class="voice-controls">
                    <button class="btn-search" style="font-size: 0.9em; padding: 10px;">üé§ Start Recording</button>
                    <button class="btn-search" style="font-size: 0.9em; padding: 10px;">‚è∏Ô∏è Stop Recording</button>
                    <button class="btn-search" style="font-size: 0.9em; padding: 10px;">üîá Play Response</button>
                </div>
                
                <!-- Text Input Fallback -->
                <input type="text" class="voice-input" placeholder="üí¨ Or type your message for JARVIS..." style="color: #333333; width: 100%; margin-top: 10px; padding: 12px; border: 1px solid #e0e0e0; border-radius: 8px;">
                <button class="btn-search" style="width: 100%; margin-top: 10px;">üì§ Send Message</button>
                
                <button class="btn-search" onclick="closeVoicePopup()" style="width: 100%; margin-top: 10px; background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);">‚ùå Close Voice Chat</button>
            </div>
        </div>
    </div>
</body>
</html>